 \documentclass[a4paper,11pt]{report}

\include{packages}
\makeindex
\include{newcommands}
\newcommand{\modes}{\textsc{Modes}}

\title{\textbf{\modes: normal modes tool\\\ \\Manual}}
\date{}
\author{Ben Hourahine}

\begin{document}
\maketitle

\setcounter{tocdepth}{1}
\tableofcontents

\setlength{\parindent}{0pt}
\setlength{\parskip}{6pt}

\chapter{Introduction}

The \modes{} program calculates vibrational modes using data created by a
calculation performed with \dftbp{}.

\chapter{Input for \modes}

The input file for \modes{} must be named \verb|modes_in.hsd| and
should be a Human-friendly Structured Data (HSD) formatted
file.\footnote{ For the details of the HSD format, please consult the
  manual of the {\dftbp} code at
  \href{http://www.dftb-plus.info}{http://www.dftb-plus.info}.} The
program can read the input in XML instead of HSD format if the input
file is \verb|modes_in.xml|. The input file must be present in the
working directory. As with {\dftbp} to prevent ambiguity, the parser
refuses to read in any input if two types of input file are present.

The input file for {\modes} must contain the properties listed in
the tables of the following sections. The first column of each table
specifies the name of the property. The second column indicates the
type of the expected value for that property.  The letters ``i'',
``r'', ``s'', ``p'', ``m'' stand for integer, real, string, property
list and method type, respectively. An optional prepended number
specifies how often (if more than once) this type must occur. An
appended ``+'' indicates arbitrary occurrence greater than zero, while
``*'' allows also for zero occurrence.  Alternative types are
separated by ``|''.  Parentheses serve only the delimitation of
groups.

Sometimes a property is only interpreted if some conditions are met.
If this is the case, the appropriate conditions are indicated in the
third column. The fourth column contains the default value for the
property.  If no default value is specified (``-''), the user is
required to assign a value to that property.  The description of the
properties immediately follows the table.  If there is also a more
detailed description available for a given keyword somewhere else, the
appropriate page number appears in the last column.

Some properties are allowed to carry a modifier to alter the provided
value (e.g. converting between units). The possible modifiers are
listed between brackets ([]) in the detailed description of the
property. If the modifier is a conversion factor for a physical unit,
only the unit type is indicated (length, energy, force, time, etc.). A
list of the allowed physical units can be found in Appendix~\ref{app:units}.

\section{Main input}

The table below contains the list of the properties, which must occur in the
input file \verb|modes_in.hsd|:

\begin{ptableh}
  \kw{Geometry} & p|m &  & - & \pref{Geometry} \\
%  \kw{Options} & p & & \cb & \pref{Options} \\
  \kw{Hessian} & p & & \cb & \pref{Hessian} \\
%  \kw{Masses} & p & & \cb & \pref{Masses} \\
  \kw{SlaterKosterFiles} &p|m&  & - & \pref{SlaterKosterFiles} \\
\end{ptableh}

Additionally optional definitions may be present:
\begin{ptableh}  
  \kw{DisplayModes} & p & & - & \pref{DisplayModes} \\
  \kw{Atoms} & i+|m &  & 1:-1 & \\
\end{ptableh}

\begin{description}
\item[\is{Geometry}] Specifies the geometry for the system to be
  calculated.  See p.~\pref{Geometry}.
%\item[\is{Options}] Contains the options for \modes{}. See
%  p.~\pref{Options}.
\item[\is{Hessian}] Contains the second derivatives matrix of the
  system energy with respect to atomic positions. See
  p.~\pref{Hessian}.
\item[\is{SlaterKosterFiles}] Name of the Slater-Koster files for
  every atom type pair combination. See~\pref{SlaterKosterFiles}.
\item[\is{DisplayModes}] Optional settings to plot the eigenmodes of
  the vibrations. See~\pref{DisplayModes}.
\item[\is{Atoms}] Optional list of atoms, ranges of atoms and/or the
  species of atoms for which the Hessian has been supplied. \emph{This must be
  equivalent to the setting you used for \is{MovedAtoms} in your \dftbp{} input
  when generating the Hessian.}
\end{description}

\htsection{Geometry}

The geometry can be specified either directly by passing the
appropriate list of properties or by using the \is{GenFormat\cb}
method.

\subsection{Explicit geometry specification}

If the geometry is being specified explicitely, the following
properties can be set:

\begin{ptable}
  \kw{Periodic} & l & & No &  \\
  \kw{LatticeVectors} & 9r  & Periodic = Yes & - & \\
  \kw{TypeNames} & s+ &  & - &  \\
  \kw{TypesAndCoordinates}  & (1i3r)+  &  & - & \\
\end{ptable}
\begin{description}
\item[\is{Periodic}] Specifies if the system is periodic in all 3
  dimensions or is to be treated as a cluster. If set to \is{Yes},
  property \iscb{LatticeVectors} must be also specified.
\item[\is{LatticeVectors}]\modif{\modtype{length}} The $x$, $y$ and
  $z$ components of the three lattice vectors if the system is
  periodic.
\item[\is{TypeNames}] List of strings with the names of the elements,
  which appear in your geometry.
\item[\is{TypesAndCoordinates}] \modif{relative|\modtype{length}} For
  every atom the index of its type in the \is{TypeNames} list and its
  coordinates. If for a periodic system (\is{Periodic = Yes}) the
  modifier \is{relative} is specified, the coordinates are interpreted
  in the coordinate system of the lattice vectors.
\end{description}

Example: Geometry of GaAs:
\begin{verbatim}
Geometry = {
  TypeNames = { "Ga" "As" }
  TypesAndCoordinates [Angstrom] = {
    1  0.000000     0.000000     0.000000
    2  1.356773     1.356773     1.356773
  }
  Periodic = Yes
  LatticeVectors [Angstrom] = {
     2.713546     2.713546     0.      
     0.           2.713546     2.713546
     2.713546     0.           2.713546
  }
}
\end{verbatim}

\htcbsubsection{GenFormat}

You can use the generic format to specify the geometry (see the
{\dftbp} manual). The geometry specification for GaAs would be the
following:
\begin{verbatim}
Geometry = GenFormat {
  2  S
  Ga As
  1 1     0.000000     0.000000     0.000000
  2 2     1.356773     1.356773     1.356773
  0.000000     0.000000     0.000000
  2.713546     2.713546     0.      
  0.           2.713546     2.713546
  2.713546     0.           2.713546
}
\end{verbatim}
It is also possible to include the gen-formatted geometry from a file:
\begin{verbatim}
Geometry = GenFormat {
  <<< "geometry.gen"
}
\end{verbatim}

\htsection{SlaterKosterFiles}

The Slater-Koster files are required to determine the masses of the
atoms for the vibrational modes.

There are two different ways to specify the Slater-Koster files for
the atom type pairs, explicit specification and using the
\iscb{Type2FileNames} method.

\subsubsection{Explicit specification}

Every possible atom type pair connected by a dash must occur as property with
the name of the corresponding file as assigned value.

Example (GaAs):
  \invparskip
\begin{verbatim}
  SlaterKosterFiles = {
    Ga-Ga = "./Ga-Ga.skf"
    Ga-As = "./Ga-As.skf"
    As-Ga = "./As-Ga.skf"
    As-As = "./As-As.skf"
  }
\end{verbatim}

If you treat shells from different species as shells of one atom by using the
\iscb{SelectedShells} keyword in the \iscb{MaxAngularMomentum} block, you have
to specify more than one file name for certain species pairs. (For details see
the description about the \iscb{MaxAngularMomentum} keyword.)

\htcbsubsubsection{Type2FileNames}

You can use this method to generate the name of the Slater-Koster files
automatically using the element names from the geometry input. You have to
specify the following properties
\begin{ptable}
  \kw{Prefix} & s &  & "" & \\
  \kw{Separator} &s &  & "" & \\
  \kw{Suffix} & s & & "" & \\
  \kw{LowerCaseTypeName} & l & & No & \\
\end{ptable}
\begin{description}
\item[\is{Prefix}] Prefix before the first type name, usually the path.
\item[\is{Separator}] Separator between the type names.
\item[\is{Suffix}] Suffix after the name of the second type, usually extension.
\item[\is{LowerCaseTypeName}] If the name of the types should be converted to
  lower case. Otherwise they are used in the same way, as they were specified in
  the geometry input.
\end{description}

Example (for producing the same file names as in the previous section):
\invparskip
\begin{verbatim}
  SlaterKosterFiles = Type2FileNames {
    Prefix = "./"
    Separator = "-"
    Suffix = ".skf"
    LowerCaseTypeName = No
  }
\end{verbatim}

The \is{Type2FileNames} method can not be used, if an extended basis
was defined with the \is{SelectedShells} method.

\htcbsubsection{Hessian}

Contains the second derivatives\index{Hessian} of the energy suplied
by {\dftbp}. The derivatives matrix must be stored as the following
order: For the $i$, $j$ and $k$ directions of atoms $1 \ldots n$
as $$\frac{\partial^2 E}{\partial x_{i1} \partial x_{i1}}
\frac{\partial^2 E}{\partial x_{j1} \partial x_{i1}} \frac{\partial^2
  E}{\partial x_{k1} \partial x_{i1}} \frac{\partial^2 E}{\partial
  x_{i2} \partial x_{i1}} \frac{\partial^2 E}{\partial x_{j2} \partial
  x_{i1}} \frac{\partial^2 E}{\partial x_{k2} \partial x_{i1}} \ldots
\frac{\partial^2 E}{\partial x_{kn} \partial x_{kn}}$$

{\em Note}: for supercell calculations, the modes are currently
obtained at the $\mathbf{q}=0$ point, irrespective of the k-point
sampling used.


\htcbsubsection{DisplayModes}
Allows the eigenvectors of the system to be plotted out if present

\begin{ptable}
\kw{PlotModes} & i+|m &  & 1:-1 & \\
\kw{Animate} & l & & Yes &  \\
\kw{XMakeMol} & l & & Yes &  \\
\end{ptable}
\begin{description}
\item[\is{PlotModes}] Specifies list of which eigenmodes should be
  plotted as xyz files. Remember that there are $3N$ modes for the
  system (including translation and rotation).
\item[\is{Animate}] Produce separate animation files for each mode or
  a single file multiple modes where the mode vectors are marked for
  each atom.
\item[\is{XMakeMol}] Adapt xyz format output for XMakeMol dialect xyz
  files.
\end{description}
\appendix

\include{unit_mod}

%%% Reference

\phantomsection\addcontentsline{toc}{chapter}{Index}
\printindex

\end{document}


%%% Local Variables: 
%%% mode: latex
%%% TeX-master: t
%%% End: 
